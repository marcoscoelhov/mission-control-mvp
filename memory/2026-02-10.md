# 2026-02-10

## Reinado CRM status (mobile-first)
- User tested mission flow on mobile and asked if autonomous multi-agent flow + inter-agent chat are active.
- Current truthful status communicated: not fully active yet.
- Key gaps confirmed:
  - Mission progress endpoint still failing in some runtime paths (critical blocker).
  - Some Reinado action routes reported 404 in smoke tests (oficiais ping, mapa protocolo, alertas ação).
  - Approvals logic can accept nonexistent card IDs (logic flaw).
  - Agent-to-agent chat is not yet exposed as a real visible mobile chat flow.
  - Extra mock screens exist but navigation/real backend wiring is incomplete.

## QA/go-live decision
- Final QA recommendation received: NO-GO until critical endpoints and approval validation are fixed, then rerun smoke.

## Temporary access workaround used
- To unblock user testing, service on :5001 was restarted with `CRM_AUTH_DISABLED=1`.
- User was told to reopen in anonymous/private tab if browser cached auth prompt persists.

## User expectation to preserve
- User expects true autonomous agent flow, visible inter-agent conversation, full access to mobile screens, and real (not mock-only) interactions.

## Model/provider preference update
- User asked to add OpenRouter provider and shared an API key.
- OpenRouter was configured temporarily, but model resolution/allowlist mismatches caused errors (unknown/not allowed model in runs).
- User explicitly requested rollback: "Volte o Stark para o kimi k2.5 e esqueça esse negócio de openrouter".
- Final state applied:
  - Stark primary model restored to `kimi-coding/k2p5`.
  - OpenRouter entries removed from config (env key/profile/order/default models).
  - Gateway restarted successfully after full revert.

## Critical product priority (production readiness)
- User made clear that UX/cosmetics are secondary; core autonomy is the real production criterion.
- Required core flow (must be real, not mock): Monarca sends mission -> Stark orchestrates/breaks down -> Jarvis approves/rejects -> officers execute -> state visible and persistent.
- If this chain is not working end-to-end, user considers system far from production.
- A dedicated audit/hotfix track was launched to validate and fix this core flow with strict GO/NO-GO verdict.

## Operating model preference (multi-agent)
- User explicitly requested using specialized agents by role:
  - Thanos for coding/backend execution
  - Wanda for design/UX improvements
  - Stark (Kimi K2.5) as orchestrator brain
- Runtime currently blocks direct `agentId` selection for `sessions_spawn` (allowlist restriction), so delegation was executed as parallel Stark subagent tracks with explicit role prompts ("act as Thanos" and "act as Wanda").
- User requested a full CRM audit by Thanos + Wanda; both parallel audit tracks were launched and pending consolidation.

## Preference update (guiding principles)
- User requested removing/ignoring the principles "KISS" and "YAGNI" from assistant memory/guidance for this project.

## Audits completed (Wanda + Thanos)
- UX/Product audit completed and documented in `AUDITORIA_WANDA_CRM.md`.
  - Main findings: frontend instability from broken JS bindings, fragmented journey between Kanban and Reinado, accessibility/mobile issues, and need for clearer monarca command visibility.
- Technical/Production audit completed and documented in `AUDITORIA_THANOS_CRM.md`.
  - Main findings: production hardening still needed despite core progress; high failing test count snapshot; API contract inconsistency and operational robustness gaps.
  - Quick fixes already applied by audit: auth hardening defaults and DB init seed structural fix.
- User asked explicitly: "O que eles acharam que precisa ser mudado?" and received a concise prioritized summary.

## Additional execution updates (late session)
- User reported UX defects still visible in mobile: repeating sync badge, broken bottom menu taps, chip labels overflowing, non-working filters (Em Combate/Diplomacia/Espionagem), counters not matching reality, and weak progress visibility.
- Immediate patches were applied in `static/reinado_views/runtime_patch.js` with cache-bust bumps:
  - v9: silent polling (reduced spam), chip filter binding + visual fixes, mission counters update.
  - v10: mobile nav clickability/z-index improvements and periodic `/api/workers/heartbeat` trigger when auto-exec is enabled.
  - v11: delete action added + filter mapping refined.
  - v12/v14: bottom nav lifted further for Android Chrome overlap.
  - v13/v16: delete button restyled to minimal and moved to top-right overlay.
  - v15: delete flow switched to session endpoint first (`/api/card/<id>`).
  - v17: new "Concluídas" tab + done missions removed from active list.
  - v18/v19: decree composer starts empty + hydration no longer overwrites typing.
- Backend delete failure fixed:
  - cause: FK constraint with `decree_ingest`.
  - fix in `db/core.py`: delete `decree_ingest` rows by `card_id` before deleting card.
- Commits (latest sequence):
  - `face0a2`, `e214d8d`, `bd7811d`, `17ae647`, `83e3fd0`, `aa93975`, `fc6fe5a`, `b36030c`, `aef88d3`.

## Autonomy mode activation status
- User asked to activate autonomous mode and reduce failures.
- Applied operational setup:
  - `crm-kanban.service` restarted/enabled under systemd.
  - `auto_exec_enabled=true` confirmed via `/api/reinado/ajustes`.
  - Added `crm-worker-heartbeat.timer` (15s) calling `/api/workers/heartbeat`.
  - Added `crm-healthcheck.timer` (1min) with self-heal restart if `/api/reinado/state` fails.
- Current important caveat communicated to user:
  - still running with `CRM_AUTH_DISABLED=1`; must be hardened before true production.

## Morning status summary delivered
- User asked: "como funcionou no modo autônomo / pendências / onde paramos".
- Report sent: autonomy is running with services/timers active; pending hardening and integration gaps remain.

## Production hardening and auth transition
- User approved final production hardening step.
- Applied:
  - `CRM_AUTH_DISABLED=0` in service override.
  - `crm-kanban.service` set to gunicorn workers=1 threads=4 via override.
  - Timers for autonomy and healthcheck remained active.
- Created/used credentials for login flow:
  - user: `marcos@stark.crm` (admin account)
  - password set in `.env` and user auth DB.
- Fixed login/auth mismatch and API auth coupling:
  - form schema now ignores csrf extra field (`unknown=EXCLUDE`) in auth views.
  - `verify_password` now accepts JWT cookie (`jwt_access_token`) for API access after web login.
  - root authenticated access forced to `/reinado`.

## User-reported UX gaps and rapid iterations
- User confirmed many issues via screenshots:
  - loaded old board or mock-heavy pages,
  - support pages looked mock, missing clear config access,
  - menu overlap in mobile Chrome,
  - delete failures, chip truncation, noisy sync badge.
- Multiple runtime patch iterations delivered (v9 through v21), including:
  - mobile nav positioning fixes,
  - mission filters/tabs (including Concluídas),
  - subtle top-right delete button,
  - composer empty placeholders and no hydration overwrite while typing,
  - support-page desmock overlays with real API data,
  - quick navigator introduced then refined into discrete hamburger,
  - operational panel now integrated with bottom settings gear; floating gear removed.
- Critical delete backend bug fixed:
  - FK constraint from `decree_ingest` prevented card deletion.
  - `db/core.py` updated to delete `decree_ingest` references before deleting card.

## Current user preference/state
- User wants strict visual fit and minimal/discreet controls (no intrusive overlays).
- User wants support pages to be operational (not mock-feeling) and settings discoverable through native navigation.

## Latest UX feedback and adjustments
- User requested:
  - pages menu must be discreet hamburger matching theme,
  - operational settings integrated into existing bottom gear (no duplicate floating gear),
  - Chrome mobile bottom menu still being covered.
- Applied patch iteration to address this:
  - `runtime_patch.js` now uses discrete hamburger (`☰`) instead of prominent "Páginas" label.
  - Removed extra floating ops gear and integrated ops panel toggle via bottom settings button on mission page.
  - Kept iterative mobile bottom-nav lift adjustments for Chrome overlap.

## End-to-end/final validation artifacts
- E2E buttons/functions audit delivered: `VALIDACAO_E2E_BOTOES_FUNCOES.md`.
- Full desmock/design/functions round delivered: `REINADO_FULL_FIX_REPORT.md` + `DEMOCK_SUPORTE_EXEC.md`.
- User requested strict pass on remaining mocks/design issues and missing pages access.

## New ZIP reference round (latest)
- User sent new official ZIP references and requested a new dual validation pass.
- ZIPs received:
  - `/root/.openclaw/media/inbound/file_52---2c061b88-e30d-4c90-aa8f-26184afd97ea.zip`
  - `/root/.openclaw/media/inbound/file_53---810cb754-3a75-4a6c-aeed-4bbd3d408fe2.zip`
- Two parallel tracks launched:
  - Wanda: visual deep pass against ZIPs + corrective adjustments.
  - Thanos: technical validation/regression check after visual adjustments.
- Both completed and reported fixes + reports.

## Destructive reset requested by user
- User explicitly requested full deletion of CRM: "apaga tudo... pode apagar tudinho" and confirmed scope as "Tudo".
- Executed full CRM purge:
  - removed project directory: `/root/.openclaw/workspace/projects/crm-kanban`
  - removed data directory: `/root/.openclaw/workspace/data/crm-kanban`
  - disabled/removed CRM-related systemd units/timers (`crm*`)
  - removed CRM helper scripts/binaries created during stabilization
  - removed CRM/Reinado report artifacts from workspace root when present
  - stopped remaining gunicorn processes and ensured port 5001 not listening
- Final state confirmed:
  - no `crm` units listed in systemd
  - nothing listening on `:5001`
- Next expected action offered to user: bootstrap a new clean project from zero.

## Autonomous mode verification (user-created mission)
- User asked to validate autonomous flow immediately after creating a mission.
- Validation run showed mission initially queued in Backlog due to queue order.
- After manual pull, mission entered execution and progress increased in sequence (20% -> 30% -> 40% -> 50%), confirming autonomous engine active.
- Insight captured: perception of stall can be queue/priority ordering, not engine failure.

## Full CRM residue purge (follow-up)
- User reinforced scope: remove any remaining CRM app/process/services, including other leftovers.
- Found active residue on host:
  - cron entry every 5 minutes launching `crm-autoexec-robust.py`.
  - very large backlog of running `crm-autoexec-robust.py` processes.
  - remaining helper scripts in `/root/.openclaw/workspace/scripts/` with `crm*` names.
- Actions executed:
  - killed all `crm-autoexec-robust.py` and `python3 app.py` residual processes.
  - removed CRM cron entry from root crontab.
  - deleted remaining CRM scripts (`crm-autoexec-simple.sh`, `crm-browser-test.js`, `crm-runner.sh`, `crm_drive_sync.sh`, `crm_gog_drive_sync.sh`, and robust launcher) and old `crm-autoexec` log.
- Final validation: no CRM-related processes, no CRM cron lines, no CRM scripts in workspace scripts folder, no listeners on `:5001`, and no CRM systemd units/files.

## Additional CRM project cleanup (safe OpenClaw-preserving pass)
- User asked to delete any other CRM/Kanban-related project artifacts but keep OpenClaw safe.
- Removed confirmed workspace projects/artifacts:
  - `/root/.openclaw/workspace/crm-web`
  - `/root/.openclaw/workspace/crm-api`
  - `/root/.openclaw/workspace/crm-playwright-test`
  - `/root/.openclaw/workspace-stark/crm-reinado-fase1`
  - `/root/.openclaw/workspace/crm.md`
  - `/root/.openclaw/workspace/auditoria_crm_2026-02-08.md`
  - `/root/.openclaw/workspace/crm-screenshot.png`
- Post-check: no matching CRM/Kanban/Reinado paths/files remained under the scanned workspace roots.
- OpenClaw remained running after cleanup (`gateway service: running`).

## Apps organization standard (new)
- User requested a single central directory named `app` to keep all current and future apps organized.
- Created central folder: `/root/.openclaw/workspace/app`.
- Moved detected app projects into it:
  - `escala` (from `_repos/escala`)
  - `yt-automator` (from `_repos/yt-automator`)
  - `yt-automator-lite` (from `projects/yt-automator`)
- Added compatibility symlinks so old paths continue to work (to avoid breakage):
  - `/root/.openclaw/workspace/_repos/escala` -> `/root/.openclaw/workspace/app/escala`
  - `/root/.openclaw/workspace/_repos/yt-automator` -> `/root/.openclaw/workspace/app/yt-automator`
  - `/root/.openclaw/workspace/projects/yt-automator` -> `/root/.openclaw/workspace/app/yt-automator-lite`
  - `/root/.openclaw/workspace/apps` -> `/root/.openclaw/workspace/app`
- OpenClaw validated still running after organization.

## YT Automator cleanup adjustment
- User asked to delete `yt-automator-lite` and keep only the full `yt-automator`.
- Removed: `/root/.openclaw/workspace/app/yt-automator-lite`.
- Repointed compatibility path:
  - `/root/.openclaw/workspace/projects/yt-automator` -> `/root/.openclaw/workspace/app/yt-automator`
- Validation: only `escala` and `yt-automator` remain under `/root/.openclaw/workspace/app`; OpenClaw service still running.

## Dashboard "Mission Control" (APP) — referência visual + preferências
- User enviou referência visual de dashboard e pediu para construir versão similar em `APP/` com **tema dark + glassmorphism** e mesma estrutura macro de layout.
- Implementação criada em:
  - `APP/index.html`
  - `APP/styles.css`
  - `APP/script.js`
- Preferência explícita de UX: **dar mais espaço para os cards do board**; painel **Live** deve iniciar colapsado.
- Refinamento solicitado e aplicado: controle de colapso do Live deve ficar no **header** (Mission Queue) com **ícone sutil** (não botão chamativo dentro do próprio painel Live).
- Acesso remoto para revisão foi feito via Tailscale com servidor local em `http://100.73.57.32:8080`.

## Preferência de modelo (sessão atual)
- User pediu para trocar para GPT-5.2, mas não estava permitido.
- User decidiu explicitamente: **manter GPT-5.3-codex** nesta sessão.

## APP dashboard MVP evolution (Mission Control)
- User approved visual direction and requested iterative upgrades on `APP/`.
- Remote preview setup used over Tailscale at `http://100.73.57.32:8080` (python http.server on port 8080).
- UX preference clarified: Live panel should be collapsed to maximize kanban card space.
- Refinement clarified again: collapse control should be in header with subtle icon; final implementation moved toggle to top header area and made Live collapse to effective width zero.
- Cache-busting pattern used in `index.html` (`styles.css?v=N`, `script.js?v=N`) to force remote refresh on other device.

## Functional upgrades delivered in APP
- Added V2 features:
  - drag-and-drop between kanban columns,
  - premium mobile responsiveness (horizontal snap columns + improved compact layout),
  - dynamic data loading with fallback (`/api/dashboard` -> `APP/data.json`).
- Added move persistence attempt for DnD with endpoint fallback chain:
  - `/api/dashboard/move`, `/api/cards/move`, `/api/card/move`.
  - If unavailable, UI keeps local move and logs warning.
- Added agent sidebar connection for "real" OpenClaw agents with source fallback:
  - `/api/openclaw/agents` -> `APP/openclaw-agents.json`.

## GitHub publication outcome
- User asked to delegate to Thor for GitHub publish; deployment completed successfully.
- Repo created/published: `https://github.com/marcoscoelhov/mission-control-mvp`.
- User intent: keep iterating rapidly on this MVP and wire real backend/OpenClaw data.
